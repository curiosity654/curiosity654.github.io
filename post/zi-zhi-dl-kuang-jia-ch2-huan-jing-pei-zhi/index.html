
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>自制DL框架 Ch2 环境配置 | Curiosity&#39;s Blog</title>
<meta name="description" content="温故而知新">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://mrcuriosity.top/favicon.ico?v=1597218972726">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://mrcuriosity.top/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-174993688-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-174993688-1');
</script>


  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://mrcuriosity.top">
        <img class="avatar" src="https://mrcuriosity.top/images/avatar.png?v=1597218972726" alt="" width="32px" height="32px">
      </a>
      <a href="https://mrcuriosity.top">
        <h1 class="site-title">Curiosity&#39;s Blog</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/" class="menu purple-link">
            首页
          </a>
        
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/tags" class="menu purple-link">
            标签
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
          <h2 class="post-title">自制DL框架 Ch2 环境配置</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2020-08-12</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://mrcuriosity.top/tag/StlSdXPG9/">
                    AI框架
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <p>json 解析库和矩阵运算库配置还是费了番功夫</p>
<p>json 解析选择 jsoncpp，矩阵运算选择armadillo，二者都可以使用 brew 直接安装</p>
<pre><code class="language-bash">brew install jsoncpp
brew install armadillo
</code></pre>
<p>jsoncpp 测试序列化：</p>
<pre><code class="language-cpp">int main() {
    Json::FastWriter jWriteFast;
		Json::StyledWriter jStyledWrite;
		Json::Value jRoot;
		jRoot[&quot;key&quot;] = &quot;name&quot;;
		jRoot[&quot;value&quot;] = &quot;linghuchong&quot;;
		std::string strRetJson = jWriteFast.write(jRoot);
		std::cout &lt;&lt; strRetJson &lt;&lt; std::endl;
		std::cout &lt;&lt; &quot;styled:-------------------------------------&quot; &lt;&lt; std::endl;
		std::string strStyled = jStyledWrite.write(jRoot);
		std::cout &lt;&lt; strStyled &lt;&lt; std::endl;
    
    return EXIT_SUCCESS;
}
</code></pre>
<p>CMakeList 里边只需要包含头文件，连接库即可</p>
<pre><code class="language-cpp">cmake_minimum_required(VERSION 3.2)
project(testjson)
set(CMAKE_BUILD_TYPE Release)
add_compile_options(-std=c++11)

include_directories (&quot;/usr/local/Cellar/jsoncpp/1.9.3/include&quot;)
link_libraries(&quot;/usr/local/Cellar/jsoncpp/1.9.3/lib/libjsoncpp.dylib&quot;)

set(MAIN_SRCS &quot;main.cpp&quot;)
add_executable(main ${MAIN_SRCS})
</code></pre>
<p>Armadillo 测试</p>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;armadillo&gt;

using namespace std;
using namespace arma;

int main()
{
	mat A = randu&lt;mat&gt;(4,5);
	mat B = randu&lt;mat&gt;(4,5);

	cout &lt;&lt; A*B.t() &lt;&lt; endl;

	return 0;
}
</code></pre>
<p>CMakeList</p>
<pre><code class="language-cpp">cmake_minimum_required(VERSION 3.2)
project(testarma)
set(CMAKE_BUILD_TYPE Release)
add_compile_options(-std=c++11)

include_directories (&quot;/usr/local/Cellar/armadillo/9.900.1_1/include&quot;)
link_libraries(&quot;/usr/local/Cellar/armadillo/9.900.1_1/lib/libarmadillo.dylib&quot;)

set(MAIN_SRCS &quot;main.cpp&quot;)
add_executable(main ${MAIN_SRCS})
</code></pre>
<p>此时问题出现了，编译运行后出现 bus error，但是如果不使用randu，使用zeros之类的函数可以正常运行，这就非常玄学了</p>
<p><a href="https://github.com/mlpack/mlpack/issues/284">[OS X] bus error at execution · Issue #284 · mlpack/mlpack</a></p>
<p>github 上有一个类似的错误，取消 C11 编译选项后能够正常运行，但是 jsoncpp 的编译需要 C11 支持... 这就很尴尬</p>
<p><a href="https://stackoverflow.com/questions/38103832/armadillo-randu-doesnt-work">Armadillo randu doesn't work</a></p>
<p>这里有个类似的问题，说的是 randu 函数返回全0，有个回答说去 armadillo 配置里取消 <code>USE_WRAPPER</code>，去瞅了一眼，是这么说的</p>
<pre><code class="language-cpp">#define ARMA_USE_WRAPPER
//// Comment out the above line if you're getting linking errors when compiling your programs,
//// or if you prefer to directly link with LAPACK, BLAS + etc instead of the Armadillo runtime library.
//// You will then need to link your programs directly with -llapack -lblas instead of -larmadillo
</code></pre>
<p>需要手动连接 LAPACK 和 BLAS，于是在CMakeLists 中添加：</p>
<pre><code class="language-cpp">cmake_minimum_required(VERSION 3.2)
project(testarma)
set(CMAKE_BUILD_TYPE Release)
find_package(BLAS)
find_package(LAPACK)
if(LAPACK_FOUND AND BLAS_FOUND)
   set(lapackblas_libraries ${BLAS_LIBRARIES} ${LAPACK_LIBRARIES})
endif()

add_compile_options(-std=c++11)

include_directories (&quot;/usr/local/Cellar/armadillo/9.900.1_1/include&quot;)
link_libraries(&quot;/usr/local/Cellar/armadillo/9.900.1_1/lib/libarmadillo.dylib&quot;)

set(MAIN_SRCS &quot;main.cpp&quot;)
add_executable(main ${MAIN_SRCS})
target_link_libraries(main ${lapackblas_libraries})
</code></pre>
<p>计划通，可以正常运行<br>
<img src="https://mrcuriosity.top/post-images/1597218814950.png" alt="" loading="lazy"></p>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://mrcuriosity.top/post/u-gat-it-lun-wen-yue-du/">
              <h3 class="post-title">
                下一篇：U-GAT-IT 论文阅读
              </h3>
            </a>
          </div>
          
      </div>

      

      <div class="site-footer">
  <div class="slogan">温故而知新</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://mrcuriosity.top/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
