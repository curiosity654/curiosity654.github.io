<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>自制DL框架 Ch2 环境配置 | Curiosity&#39;s Blog</title>
<meta name="referrer" content="never" />
<link rel="shortcut icon" href="https://mrcuriosity.top/favicon.ico">
<link rel="stylesheet" type="text/css" href="https://mrcuriosity.top/styles/main.css">
    <meta name="description" content="总体设计模仿 Caffe，使用配置文件定义网络结构和训练参数（后期可能会改成 Api 调用，不过关系不大），配置文件用 json 格式定义，使用 jsoncpp 进行解析，矩阵运算选择 armadillo，二者都可以使用 brew 直接安装..." />
    
    
    <link rel="prefetch" href="https://mrcuriosity.top/post/zi-zhi-dl-kuang-jia-ch3-ji-chu-shu-ju-jie-gou/">
    
    
    <link rel="prefetch" href="https://mrcuriosity.top/post/u-gat-it-lun-wen-yue-du/">
    
  </head>
  <body>
    <!-- start: #wrapper -->
    <header id="header" style="">
        <div class="header-container">
  <h1 class="site-title"><a href="https://mrcuriosity.top">Curiosity&#39;s Blog</a></h1>
  <h2 class="site-description">温故而知新</h2>
  <nav class="main-navigation">
    <ul id="" class="">
      
      <li class="" ><a href="/" class="menu">首页</a></li>
      
      <li class="" ><a href="/archives" class="menu">归档</a></li>
      
      <li class="" ><a href="/tags" class="menu">标签</a></li>
      
      <li class="" ><a href="/post/about" class="menu">关于</a></li>
      
    </ul>
  </nav>
  <div class="my_socials">
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>
    </header>
    <div class="wrapper single">
        <div class="content">
            <div id="posts" class="posts">
            <!-- start: .articles -->
            
            <article class="post hentry format-daily format-StlSdXPG9">
                <header>
                    <time class="date">
                        <i class="fa">
                            <span class="datetime">2020-08-12</span>
                        </i>
                    </time>
                </header>
                <h1 class="entry-title">
                    自制DL框架 Ch2 环境配置
                </h1>
                <div class="post-content">
                    <div class="post-hentry">
                        <p>总体设计模仿 Caffe，使用配置文件定义网络结构和训练参数（后期可能会改成 Api 调用，不过关系不大），配置文件用 json 格式定义，使用 jsoncpp 进行解析，矩阵运算选择 armadillo，二者都可以使用 brew 直接安装。</p>
<pre><code class="language-bash">brew install jsoncpp
brew install armadillo
</code></pre>
<p>jsoncpp 测试序列化：</p>
<pre><code class="language-cpp">int main() {
    Json::FastWriter jWriteFast;
		Json::StyledWriter jStyledWrite;
		Json::Value jRoot;
		jRoot[&quot;key&quot;] = &quot;name&quot;;
		jRoot[&quot;value&quot;] = &quot;linghuchong&quot;;
		std::string strRetJson = jWriteFast.write(jRoot);
		std::cout &lt;&lt; strRetJson &lt;&lt; std::endl;
		std::cout &lt;&lt; &quot;styled:-------------------------------------&quot; &lt;&lt; std::endl;
		std::string strStyled = jStyledWrite.write(jRoot);
		std::cout &lt;&lt; strStyled &lt;&lt; std::endl;
    
    return EXIT_SUCCESS;
}
</code></pre>
<p>CMakeList 里边只需要包含头文件，连接库即可</p>
<pre><code class="language-cpp">cmake_minimum_required(VERSION 3.2)
project(testjson)
set(CMAKE_BUILD_TYPE Release)
add_compile_options(-std=c++11)

include_directories (&quot;/usr/local/Cellar/jsoncpp/1.9.3/include&quot;)
link_libraries(&quot;/usr/local/Cellar/jsoncpp/1.9.3/lib/libjsoncpp.dylib&quot;)

set(MAIN_SRCS &quot;main.cpp&quot;)
add_executable(main ${MAIN_SRCS})
</code></pre>
<p>Armadillo 测试</p>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;armadillo&gt;

using namespace std;
using namespace arma;

int main()
{
	mat A = randu&lt;mat&gt;(4,5);
	mat B = randu&lt;mat&gt;(4,5);

	cout &lt;&lt; A*B.t() &lt;&lt; endl;

	return 0;
}
</code></pre>
<p>CMakeList</p>
<pre><code class="language-cpp">cmake_minimum_required(VERSION 3.2)
project(testarma)
set(CMAKE_BUILD_TYPE Release)
add_compile_options(-std=c++11)

include_directories (&quot;/usr/local/Cellar/armadillo/9.900.1_1/include&quot;)
link_libraries(&quot;/usr/local/Cellar/armadillo/9.900.1_1/lib/libarmadillo.dylib&quot;)

set(MAIN_SRCS &quot;main.cpp&quot;)
add_executable(main ${MAIN_SRCS})
</code></pre>
<p>此时问题出现了，编译运行后出现 bus error，但是如果不使用randu，使用zeros之类的函数可以正常运行，这就非常玄学了</p>
<p><a href="https://github.com/mlpack/mlpack/issues/284">[OS X] bus error at execution · Issue #284 · mlpack/mlpack</a></p>
<p>github 上有一个类似的错误，取消 C11 编译选项后能够正常运行，但是 jsoncpp 的编译需要 C11 支持... 这就很尴尬</p>
<p><a href="https://stackoverflow.com/questions/38103832/armadillo-randu-doesnt-work">Armadillo randu doesn't work</a></p>
<p>这里有个类似的问题，说的是 randu 函数返回全0，有个回答说去 armadillo 配置里取消 <code>USE_WRAPPER</code>，去瞅了一眼，是这么说的</p>
<pre><code class="language-cpp">#define ARMA_USE_WRAPPER
//// Comment out the above line if you're getting linking errors when compiling your programs,
//// or if you prefer to directly link with LAPACK, BLAS + etc instead of the Armadillo runtime library.
//// You will then need to link your programs directly with -llapack -lblas instead of -larmadillo
</code></pre>
<p>需要手动连接 LAPACK 和 BLAS，于是在CMakeLists 中添加：</p>
<pre><code class="language-cpp">cmake_minimum_required(VERSION 3.2)
project(testarma)
set(CMAKE_BUILD_TYPE Release)
find_package(BLAS)
find_package(LAPACK)
if(LAPACK_FOUND AND BLAS_FOUND)
   set(lapackblas_libraries ${BLAS_LIBRARIES} ${LAPACK_LIBRARIES})
endif()

add_compile_options(-std=c++11)

include_directories (&quot;/usr/local/Cellar/armadillo/9.900.1_1/include&quot;)
link_libraries(&quot;/usr/local/Cellar/armadillo/9.900.1_1/lib/libarmadillo.dylib&quot;)

set(MAIN_SRCS &quot;main.cpp&quot;)
add_executable(main ${MAIN_SRCS})
target_link_libraries(main ${lapackblas_libraries})
</code></pre>
<p>计划通，可以正常运行<br>
<img src="https://mrcuriosity.top/post-images/1597218814950.png" alt="" loading="lazy"></p>

                        <div class="clear"></div>
                    </div>
                </div>
            </article>
            

                <div class="pager">
                    
                        <a class="prev" href="https://mrcuriosity.top/post/zi-zhi-dl-kuang-jia-ch3-ji-chu-shu-ju-jie-gou/">自制DL框架 Ch3 基础数据结构</a>
                    
                    
                         <a class="next" href="https://mrcuriosity.top/post/u-gat-it-lun-wen-yue-du/">U-GAT-IT 论文阅读</a>
                    
                    <div class="clear"></div>
                </div>

            
              <div id="comments">
                <p>请到客户端“主题--自定义配置--valine”中填入ID和KEY</p>
              </div>
              <div class="clear"></div>
            
            
            </div>

        </div>

            <footer id="footer" class="">
        <p class="published border-effect">
          ©2020 共 8 篇文章
          <br/>
          Theme <a href="https://immmmm.com/gridea-theme-motify/" target="_blank">「Motify」</a> Powered by <a href="https://gridea.dev/" target="_blank">「Gridea」</a>
        </p>
    </footer>

    <a id="back_to_top" href="#" class="back_to_top"><span>△</span></a>


<script src="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/prism.min.js"></script>


<script src="https://cdn.jsdelivr.net/gh/lmm214/immmmm/media/js/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/lmm214/immmmm/media/js/lately.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/lmm214/immmmm/media/js/waterfall.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/lmm214/immmmm/media/js/slimbox2.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/lmm214/immmmm/media/js/functions.js"></script>


<script src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
    </div>



  </body>
</html>
